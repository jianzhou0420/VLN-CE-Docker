name: vlnce
channels:
  - aihabitat
  - conda-forge
  - pytorch
  - defaults
dependencies:
  # Python version
  - python=3.8.15

  # C++ runtime (fixes CXXABI_1.3.15 compatibility)
  - libstdcxx-ng>=12.0.0

  # Habitat simulator (headless for server environments)
  - habitat-sim=0.1.7=py3.8_headless_linux_856d4b08c1a2632626bf0d205bf46471a99502b7

  # Core dependencies
  - numpy=1.23.5
  - scipy=1.10.1
  - networkx=3.1
  - tqdm
  - attrs
  - numba
  - imageio
  - imageio-ffmpeg

  # LMDB
  - lmdb
  - python-lmdb

  # Additional conda packages
  - quaternion
  - websockets
  - jsonlines
  - msgpack-numpy
  - yacs
  - gdown

  # Pip dependencies (only what's not available or needs specific versions)
  - pip==24.0 # essential to install gym 0.21
  - pip:
      # Pin setuptools for distutils.version compatibility with PyTorch 1.9
      - setuptools==58.0.4

      # PyTorch with CUDA 11.1 (for RTX 30xx / Ampere GPUs)
      - --extra-index-url https://download.pytorch.org/whl/cu111
      - torch==1.9.0+cu111
      - torchvision==0.10.0+cu111

      # Moved from conda to avoid conflicts
      - opencv-python
      - tensorboard
      - tensorflow-cpu==2.9.0 # Only for warning suppression, not computation

      # VLN-CE specific (not in conda)
      - dtw==1.4.0
      - fastdtw==0.3.4
      - ifcfg

      # webdataset pinned for habitat-lab compatibility
      - webdataset==0.1.103

      - moviepy

      # Development
      - pre-commit

      # Project and Habitat-Lab (editable installs)
      - -e .
      - -e third_party/habitat-lab
